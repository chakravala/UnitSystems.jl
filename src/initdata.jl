
#   This file is part of UnitSystems.jl
#   It is licensed under the MIT license
#   UnitSystems Copyright (C) 2020 Michael Reed
#       _           _                         _
#      | |         | |                       | |
#   ___| |__   __ _| | ___ __ __ ___   ____ _| | __ _
#  / __| '_ \ / _` | |/ / '__/ _` \ \ / / _` | |/ _` |
# | (__| | | | (_| |   <| | | (_| |\ V / (_| | | (_| |
#  \___|_| |_|\__,_|_|\_\_|  \__,_| \_/ \__,_|_|\__,_|
#
#   https://github.com/chakravala
#   https://crucialflow.com

const deka, byte, sixty = ğŸ*ğŸ“, ğŸ^3, ğŸ^2*ğŸ‘*ğŸ“
const hecto, kilo, ğŸğŸ, ğŸ”ğŸ =  deka^2, deka^3, deka, sixty
const mega, giga, tera, peta, exa = kilo^2, kilo^3, kilo^4, kilo^5, kilo^6
const deci,centi,milli,micro,nano,pico,femto,atto = inv.((deka,hecto,kilo,mega,giga,tera,peta,exa))
const kibi,mebi,gibi,tebi,pebi,exbi,zebi,yobi = ğŸ^10,ğŸ^20,ğŸ^30,ğŸ^40,ğŸ^50,ğŸ^60,(Constant(1.0)*ğŸ)^70,(Constant(1.0)*ğŸ)^80

const fur,Â°R,K,HOUR,k = ğŸ”ğŸ*ğŸğŸ*ft,ğŸ“/ğŸ‘^2,ğŸ‘^2/ğŸ“,ğŸ”ğŸ^2,kG*Ï„/(ğŸ^7*ğŸ‘^4*ğŸ“^3)
const mâ‚‘,Î¼â‚€ = Î±inv^2*Râˆ*ğŸ*ğ˜©/ğ˜¤,ğŸ*ğ˜©/ğ˜¤*Î±/ğ˜¦^2 # â‰ˆ 4Ï€*(1e-7+5.5e-17), exact charge
const Ä§,Î¼â‚šâ‚‘,Î¼â‚‘â‚š,Ráµ¤,Î±L,Î±G,Máµ¤ = ğ˜©/Ï„,Î¼â‚šáµ¤/Î¼â‚‘áµ¤,Î¼â‚‘áµ¤/Î¼â‚šáµ¤,NA*kB,centi/ğ˜¤,(mâ‚‘/mP)^2,NA*mâ‚‘/Î¼â‚‘áµ¤
const pc,G,DAY,nm = au*ğŸ^7*ğŸ‘^4*ğŸ“^3/Ï„,ğ˜¤*Ä§/mP^2,ğŸ^7*ğŸ‘^3*ğŸ“^2,sqrt(GME/gâ‚€)*Ï„/ğŸ^5/ğŸ‘^3/ğŸ“^2
const GMâ˜‰ =au^3*k^2/DAY^2; const th = ğŸğŸ^3*pc/H0; const Î›C = ğŸ‘*Î©Î›*(th*ğ˜¤)^-2
const lc,mc,ÏÎ›,ğ˜¦â‚™,Ï‚ = ğŸ*sqrt(Ï„/Î›C),ğ˜¤^2/(ğŸ*G*sqrt(Ï„*Î›C)),Î›C*ğ˜¤^4/(ğŸ^2*Ï„)/G,ğ˜¦/âˆšÎ±,âˆš(ğŸ*Ï„)
const lcq,mcq = sqrt.(sqrt.((ğ˜¤*Ä§/ÏÎ›,ÏÎ›*Ä§^3/ğ˜¤^5))); const ğ˜¦áµ£ = ğ˜¦â‚™/Ï‚
const tcq,em,mi = lcq*sqrt(mcq/sqrt(sqrt(ÏÎ›*(ğ˜¤*Ä§)^3))),sqrt(GME/gâ‚€)*Ï„/ğŸ^9/ğŸ“^7,ğŸ^5*ğŸ‘*ğŸ“*ğŸğŸ

@pure sackurtetrode(U::UnitSystem,P=atmosphere(U),T=kelvin(U),m=dalton(U)) = normal(log((Constant(exp(5/2))*boltzmann(U)*sqrt(boltzmann(U)/gravity(U)/turn(U)/planckreduced(U)^2)^3)*(T/P*sqrt(m*T)^3)))

derived(U) = [x=>eval(:($x($U))) for x âˆˆ deleteat!(collect(UnitSystems.Derived),1)]
constants(U) = [x=>eval(:($x($U))) for x âˆˆ (:hyperfine,UnitSystems.Constants...,UnitSystems.Physics...,:loschmidt,:mechanicalheat,:wienwavelength,:wienfrequency,:sackurtetrode,:eddington,:solarmass,:jupitermass,:earthmass,:gforce,:earthradius,:greatcircle,:nauticalmile,:hubble,:cosmological)]

const Universe = Coupling(Î±G,Î±,Î¼â‚‘áµ¤,Î¼â‚šáµ¤,Î©Î›)

function unitsystem(kB,Ä§,ğ˜¤,Î¼â‚€,mâ‚‘,Máµ¤=ğŸ,Kcd=ğŸ,Î¸=ğŸ,Î»=ğŸ,Î±L=ğŸ,g=ğŸ,C=Universe,Ï„=Ï„,x=ğŸ,y=ğŸ‘,z=ğŸ“,w=ğŸ•,u=ğŸğŸ,v=ğŸğŸ—,q=ğŸ’ğŸ‘)
    UnitSystem{cache(kB),cache(Ä§),cache(ğ˜¤),cache(Î¼â‚€),cache(mâ‚‘),cache(Máµ¤),(cache(Kcd),cache(Î¸),cache(Î»),cache(Î±L),cache(g),C,cache(Ï„),cache(x),cache(y),cache(z),cache(w),cache(u),cache(v),cache(q))}()
end

function constant(::UnitSystem{a,b,c,d,e,f,g}) where {a,b,c,d,e,f,g}
    unitsystem(Constant(a),Constant(b),Constant(c),Constant(d),Constant(e),Constant(f),Constant(g[1]),Constant(g[2]),Constant(g[3]),Constant(g[4]),Constant(g[5]),Universe,Constant(g[7]),ğŸ,ğŸ‘,ğŸ“,ğŸ•,ğŸğŸ,ğŸğŸ—,ğŸ’ğŸ‘)
end

export MetricSystem, ConventionalSystem, RankineSystem
export AstronomicalSystem, ElectricSystem, GaussSystem, EntropySystem

"""
    MetricSystem(Mu=Máµ¤,Î¼0=Î¼â‚€,Ru=Ráµ¤,g0=ğŸ,Î¸=ğŸ,h=ğ˜©,me=Râˆ*ğŸ*h/ğ˜¤/Î±^2)

Constructs new `UnitSystem` from `molarmass` constant, `vacuumpermeability`, `molargas` constant, `gravity` force reference, `angle` scale, and `planck` constant.

```Julia
UnitSystem(Ru*me/Mu/Î¼â‚‘áµ¤/g0,h/Ï„/g0/Î¸,ğ˜¤,Î¼0,me,Mu,Kcd*(mâ‚‘/me)^2*(h/ğ˜©)*g0,Î¸,ğŸ,ğŸ,g0)
```

Examples include `SI2019`, `SI1976`, `Metric`, `Engineering`, `MetricTurn`, `MetricSpatian`, `MetricGradian`, `MetricDegree`, `MetricArcminute`, `MetricArcsecond`. In addition, the `ConventionalSystem` constructor further builds on `MetricSystem`, resulting in variations.

Other derived `UnitSystem` instances such as `British` or `English` or `IAU` are derived from an existing `Metric` specification generated by `MetricSystem`. The constructor `MetricSystem` incorporates several standard common numerical values and exposes variable arguments which can be substituted for customization, yielding the capability to generate historical variations having a common `Universe`.
Derivative constructors are `EntropySystem`, `ElectricSystem`, `GaussSystem`, `RankineSystem`, and `AstronomicalSystem`.
"""
MetricSystem(Mu=Máµ¤,Î¼0=Î¼â‚€,Ru=Ráµ¤,g0=ğŸ,Î¸=ğŸ,h=ğ˜©,me=Î±inv^2*Râˆ*ğŸ*h/ğ˜¤) = unitsystem(Ru*me/Mu/Î¼â‚‘áµ¤/g0,h/Ï„/g0/Î¸,ğ˜¤,Î¼0,me,Mu,Kcd*(mâ‚‘/me)^2*(h/ğ˜©)*g0,Î¸,ğŸ,ğŸ,g0,Universe,Ï„,ğŸ,ğŸ‘,ğŸ“,ğŸ•,ğŸğŸ,ğŸğŸ—,ğŸ’ğŸ‘)

"""
    ConventionalSystem(RK,KJ,Ru=Ráµ¤,g0=ğŸ) = MetricSystem(milli,ğŸ*RK/ğ˜¤*Î±,Ru,g0,ğŸ^2/RK/KJ^2)

Constructs new `UnitSystem` from von `klitzing` constant and `josephson` constant, with an optional specification of `universal` gas constant and `gravity` reference constant.

Examples include `Conventional` (based on 1990) and `CODATA` (based on 2014).
"""
ConventionalSystem(klitz,joseph,Ru=Ráµ¤,g0=ğŸ,Î¸=ğŸ) = MetricSystem(milli,ğŸ*klitz/ğ˜¤*Î±,Ru,g0,Î¸,(ğŸ*ğŸ)/klitz/(joseph*joseph))

"""
    RankineSystem(U::UnitSystem,l,m,g0=ğŸ)

Constructs new `UnitSystem` from `U` rescaled along `length` and `mass` with optional `gravity` reference constant used to define technical and engineering units.

```Julia
EntropySystem(U,ğŸ,l,m,Â°R,vacuumpermeability(U)/m/l/g0,kilo*molarmass(U),g0)
```

Examples: `FPS`, `British`, `IPS`, `English`, `Survey`.
"""
RankineSystem(u,l,m,g0=ğŸ) = EntropySystem(u,ğŸ,l,m,Â°R,UnitSystems.vacuumpermeability(u)/(m*l)/g0,UnitSystems.unit(kilo*UnitSystems.molarmass(u)),g0)

# historical units

const SI2019 = Quantity(MetricSystem())
const Metric = Quantity(MetricSystem(milli,Ï„/ğŸ^6/ğŸ“^7))
#const SI2019Engineering = Quantity(MetricSystem(Máµ¤,Î¼â‚€/gâ‚€,Ráµ¤,gâ‚€))
const Engineering = Quantity(MetricSystem(milli,Ï„/ğŸ^6/ğŸ“^7/gâ‚€,Ráµ¤,gâ‚€))
const MetricTurn = Quantity(MetricSystem(milli,Ï„/ğŸ^6/ğŸ“^7,Ráµ¤,ğŸ,ğŸ/Ï„))
const MetricSpatian = Quantity(MetricSystem(milli,Ï„/ğŸ^6/ğŸ“^7,Ráµ¤,ğŸ,ğŸ/Ï‚))
const MetricGradian = Quantity(MetricSystem(milli,Ï„/ğŸ^6/ğŸ“^7,Ráµ¤,ğŸ,ğŸ^4*ğŸ“^2/Ï„))
const MetricDegree = Quantity(MetricSystem(milli,Ï„/ğŸ^6/ğŸ“^7,Ráµ¤,ğŸ,ğŸ^3*ğŸ‘^2*ğŸ“/Ï„))
const MetricArcminute = Quantity(MetricSystem(milli,Ï„/ğŸ^6/ğŸ“^7,Ráµ¤,ğŸ,ğŸ^5*ğŸ‘^3*ğŸ“^2/Ï„))
const MetricArcsecond = Quantity(MetricSystem(milli,Ï„/ğŸ^6/ğŸ“^7,Ráµ¤,ğŸ,ğŸ^7*ğŸ‘^4*ğŸ“^3/Ï„))
const SI1976 = Quantity(MetricSystem(milli,Ï„/ğŸ^6/ğŸ“^7,Constant(8.31432)))
const CODATA = Quantity(ConventionalSystem(RK2014,KJ2014,Ráµ¤2014))
const Conventional = Quantity(ConventionalSystem(RK1990,KJ1990))
const International = Quantity(ElectricSystem(Metric,Î©áµ¢â‚œ,Váµ¢â‚œ))
const InternationalMean = Quantity(ElectricSystem(Metric,Constant(1.00049),Constant(1.00034)))

const EMU = Quantity(GaussSystem(Metric,ğŸ,ğŸ*Ï„))
const ESU = Quantity(GaussSystem(Metric,(hecto*ğ˜¤)^-2,ğŸ*Ï„))
const Gauss = Quantity(GaussSystem(Metric,ğŸ,ğŸ*Ï„,centi/ğ˜¤))
const LorentzHeaviside = Quantity(GaussSystem(Metric,ğŸ,ğŸ,centi/ğ˜¤))
#const Thomson = Quantity(GaussSystem(Metric,ğŸ,ğŸ*Ï„,inv(ğŸ)))
#const Kennelly = Quantity(GaussSystem(Metric,inv(ğŸğŸ^7),ğŸ*Ï„,ğŸ,ğŸ,ğŸ))

const British = Quantity(RankineSystem(Metric,ft,lb*gâ‚€/ft))
#const British2019 = Quantity(RankineSystem(SI2019,ft,lb*gâ‚€/ft))
const Survey = Quantity(RankineSystem(Metric,ftUS,lb,gâ‚€/ftUS))
#const Survey2019 = Quantity(RankineSystem(SI2019,ftUS,lb,gâ‚€/ftUS))
const English = Quantity(RankineSystem(Metric,ft,lb,gâ‚€/ft))
#const English2019 = Quantity(RankineSystem(SI2019,ft,lb,gâ‚€/ft))
const FPS = Quantity(RankineSystem(Metric,ft,lb))
#const FPS2019 = Quantity(RankineSystem(SI2019,ft,lb))
const IPS = Quantity(RankineSystem(Metric,ft/ğŸ^2/ğŸ‘,lb*gâ‚€*ğŸ^2*ğŸ‘/ft))
#const IPS2019 = Quantity(RankineSystem(SI2019,ft/ğŸ^2/ğŸ‘,lb*gâ‚€*ğŸ^2*ğŸ‘/ft))

#const Astronomical = Quantity(EntropySystem(Metric,ğŸ,ğŸ,ğŸ/G))
const Hubble = Quantity(AstronomicalSystem(Metric,th,ğ˜¤*th,mâ‚‘))#Ä§/th/ğ˜¤^2/mP^2))
const Cosmological = Quantity(AstronomicalSystem(Metric,lc/ğ˜¤,lc,mc))
const CosmologicalQuantum = Quantity(AstronomicalSystem(Metric,tcq,lcq,mcq))
#const EMU2019 = Quantity(EntropySystem(SI2019,ğŸ,centi,milli))
#const ESU2019 = Quantity(EntropySystem(SI2019,ğŸ,centi,milli,ğŸ,kilo*Î¼â‚€/ğ˜¤^2))
#const Mixed = Quantity(EntropySystem(Metric,ğŸ,ğŸ,ğŸ,ğŸ,Î¼â‚€))
const Nautical = Quantity(EntropySystem(Metric,HOUR,nm,em^3,ğŸ,Ï„*ğŸ‘^3/ğŸ^10/ğŸ“^12,milli))
const Meridian = Quantity(EntropySystem(Metric,ğŸ,em,em^3,ğŸ,Ï„/ğŸ^6/ğŸ“^7,milli))
#const MeridianEngineering = Quantity(EntropySystem(Metric,ğŸ,em,em^3,ğŸ,Ï„/ğŸ^6/ğŸ“^7*em/gâ‚€,milli,gâ‚€/em))
#const GravitationalSI2019 = Quantity(EntropySystem(SI2019,ğŸ,ğŸ,gâ‚€))
const Gravitational = Quantity(EntropySystem(Metric,ğŸ,ğŸ,gâ‚€))
#const GravitationalMeridian = Quantity(EntropySystem(Metric,ğŸ,em,gâ‚€*em^2,ğŸ,Ï„/ğŸ^6/ğŸ“^7*em/gâ‚€,milli))
const IAUâ˜‰ = Quantity(EntropySystem(Metric,DAY,au,GMâ˜‰/G))
const IAUE = Quantity(EntropySystem(Metric,DAY,LD,GME/G))
const IAUJ = Quantity(EntropySystem(Metric,DAY,JD,GMJ/G))
const MTS = Quantity(EntropySystem(Metric,ğŸ,ğŸ,kilo))
const KKH = Quantity(EntropySystem(Metric,HOUR,kilo,ğŸ))
const MPH = Quantity(EntropySystem(FPS,HOUR,mi,ğŸ))
const FFF = Quantity(EntropySystem(Metric,ğŸ•*ğŸ*DAY,fur,(ğŸ*ğŸ‘^2*ğŸ“)*lb,Â°R,Constant(0.),ğŸ))

# natural units

const Planck = Quantity(unitsystem(ğŸ,ğŸ,ğŸ,ğŸ,âˆš(ğŸ*Ï„*Î±G)))
const PlanckGauss = Quantity(unitsystem(ğŸ,ğŸ,ğŸ,ğŸ*Ï„,âˆšÎ±G))
const Stoney = Quantity(unitsystem(ğŸ,Î±inv,ğŸ,ğŸ*Ï„,âˆš(Î±G*Î±inv)))
const Hartree = Quantity(unitsystem(ğŸ,ğŸ,Î±inv,ğŸ*Ï„*Î±^2,ğŸ))
const Rydberg = Quantity(unitsystem(ğŸ,ğŸ,ğŸ*Î±inv,Ï„/ğŸ*Î±^2,inv(ğŸ)))
const Schrodinger = Quantity(unitsystem(ğŸ,ğŸ,Î±inv,ğŸ*Ï„*Î±^2,âˆš(Î±G*Î±inv)))
const Electronic = Quantity(unitsystem(ğŸ,Î±inv,ğŸ,ğŸ*Ï„,ğŸ))
const Natural = Quantity(unitsystem(ğŸ,ğŸ,ğŸ,ğŸ,ğŸ))
const NaturalGauss = Quantity(unitsystem(ğŸ,ğŸ,ğŸ,ğŸ*Ï„,ğŸ))
const QCD = Quantity(unitsystem(ğŸ,ğŸ,ğŸ,ğŸ,inv(Î¼â‚šâ‚‘)))
const QCDGauss = Quantity(unitsystem(ğŸ,ğŸ,ğŸ,ğŸ*Ï„,inv(Î¼â‚šâ‚‘)))
const QCDoriginal = Quantity(unitsystem(ğŸ,ğŸ,ğŸ,ğŸ*Ï„*Î±,inv(Î¼â‚šâ‚‘)))

const MetricEngineering, GravitationalMetric = Engineering, Gravitational
export SI, MKS, ME, GM, CGS, CGS2019, CGSm, CGSe, HLU, FFF, AE, EE, BG # SIE, GSI, GSI2019
export EnglishEngineering, BritishGravitational, AbsoluteEnglish, EnglishUS, EE2019, IAU
#const SIE, GSI2019, GSI = SI2019Engineering, GravitationalSI2019, GravitationalSI2019
const SI, MKS, ME, GM, IAU = SI2019, Metric, MetricEngineering, GravitationalMetric, IAUâ˜‰
const CGS, CGSm, CGSe, HLU = Gauss, EMU, ESU, LorentzHeaviside
const EnglishEngineering, BritishGravitational, BG = English, British, British
const EnglishUS, AbsoluteEnglish, AE, EE = Survey, FPS, FPS, English
#const EnglishEngineering2019,BritishGravitational2019,BG2019 = English2019,British2019,British2019
#const EE2019,AbsoluteEnglish2019,AE2019 = English2019,FPS2019,FPS2019

for u âˆˆ Systems
    @eval unitname(::typeof(normal($u))) = $(string(u))
end
